(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[860],{5953:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cosmicGameV3",function(){return n(2037)}])},2037:function(e,t,n){"use strict";n.r(t),n.d(t,{Enemy:function(){return Enemy},PhysicsEngine:function(){return PhysicsEngine},connectToServer:function(){return connectToServer},createEnemyMesh:function(){return createEnemyMesh},generateTerrain:function(){return generateTerrain},onWorldUpdate:function(){return onWorldUpdate},sendPlayerState:function(){return sendPlayerState}});var i=n(5893),o=n(7294),r=n(9008),l=n.n(r),s=n(4250),a=n(9477);function connectToServer(e){console.log("Stub: connectToServer called"),setInterval(()=>{e({message:"Dummy world update"})},5e3)}function sendPlayerState(e){console.log("Stub: sendPlayerState called",e)}function onWorldUpdate(e){console.log("Stub: onWorldUpdate registered")}let Enemy=class Enemy{update(e,t){let n=new s.Pa4().subVectors(t.position,this.mesh.position).normalize();this.mesh.position.add(n.multiplyScalar(.5*e))}constructor(){let e=new s.DvJ(3,3,3),t=new s.Wid({color:16711680});this.mesh=new s.Kj0(e,t),this.mesh.castShadow=!0}};function createEnemyMesh(){let e=new s.DvJ(3,3,3),t=new s.Wid({color:16711680}),n=new s.Kj0(e,t);return n.castShadow=!0,n}function generateTerrain(e,t,n,i,o,r){let l=new s._12(t,n,o,o);l.rotateX(-Math.PI/2);for(let e=0;e<l.attributes.position.count;e++){let t=new s.Pa4;t.fromBufferAttribute(l.attributes.position,e),t.y=Math.sin(t.x*r)*Math.cos(t.z*r)*i,l.attributes.position.setXYZ(e,t.x,t.y,t.z)}l.computeVertexNormals();let a=new s.Wid({color:2263842}),c=new s.Kj0(l,a);c.receiveShadow=!0,e.add(c)}let PhysicsEngine=class PhysicsEngine{update(e){this.objects.forEach(t=>{t.velocity.y-=this.gravity*e,t.position.addScaledVector(t.velocity,e),t.update(e)})}constructor(e){this.objects=[],this.gravity=e}};let Block=class Block extends s.Kj0{constructor(e){let t=new s.DvJ(3,3,3),n=new s.Wid({color:9127187});super(t,n),this.castShadow=!0,this.receiveShadow=!0,this.position.copy(e)}};function randomRange(e,t){return Math.random()*(t-e)+e}t.default=()=>{let e=(0,o.useRef)(null),t=(0,o.useRef)(null),[n,r]=(0,o.useState)(null),[c,d]=(0,o.useState)(0),[h,u]=(0,o.useState)(3),[w,f]=(0,o.useState)(1),[p,m]=(0,o.useState)(!1),[g,v]=(0,o.useState)([]),[y,S]=(0,o.useState)([]);return(0,o.useEffect)(()=>{let i=e.current,o=t.current;if(!i||!o)return;let l=new a.CP7({canvas:i,antialias:!0});l.setSize(window.innerWidth,window.innerHeight),l.shadowMap.enabled=!0;let d=new s.xsS;d.background=new s.Ilk(8900331);let f=new s.cPb(75,window.innerWidth/window.innerHeight,.1,1e3);f.position.set(0,15,30),d.add(f);let p=new s.Mig(16777215,.6);d.add(p);let g=new s.Ox3(16777215,.8);g.position.set(0,20,10),g.castShadow=!0,d.add(g),generateTerrain(d,200,200,100,15,.05);let x=new s.xo$(1.5,16,16),E=new s.Wid({color:65484}),b=new s.Kj0(x,E);b.castShadow=!0,b.position.set(0,10,0),d.add(b);let T={position:new s.Pa4(0,10,0),rotation:0,mesh:b,inventory:[]};r(T);let P=[];for(let e=0;e<5;e++){let e=new Enemy;e.mesh=createEnemyMesh(),e.mesh.position.set(randomRange(-50,50),10,randomRange(-50,50)),d.add(e.mesh),P.push(e)}let j=new PhysicsEngine(window.innerHeight),M=[];connectToServer(e=>{console.log("World update received:",e)});let W=o.getContext("2d");o.width=window.innerWidth,o.height=window.innerHeight;let k=function(){let e={};return window.addEventListener("keydown",t=>{e[t.code]=!0}),window.addEventListener("keyup",t=>{e[t.code]=!1}),e}();i.addEventListener("click",e=>{let t=i.getBoundingClientRect(),n=new s.FM8((e.clientX-t.left)/t.width*2-1,-(2*((e.clientY-t.top)/t.height))+1),o=new s.iMs;o.setFromCamera(n,f);let r=o.intersectObjects(d.children,!0);if(r.length>0){let e=r[0].point;e.y=1.5;let t=new Block(e);d.add(t),S(e=>[...e,t]),v(e=>[...e,"Placed Block"])}}),i.addEventListener("contextmenu",e=>{e.preventDefault();let t=i.getBoundingClientRect(),n=new s.FM8((e.clientX-t.left)/t.width*2-1,-(2*((e.clientY-t.top)/t.height))+1),o=new s.iMs;o.setFromCamera(n,f);let r=o.intersectObjects(y,!0);if(r.length>0){let e=r[0].object;d.remove(e),S(t=>t.filter(t=>t!==e)),v(e=>[...e,"Removed Block"])}});let handleResize=()=>{l.setSize(window.innerWidth,window.innerHeight),f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),o.width=window.innerWidth,o.height=window.innerHeight};window.addEventListener("resize",handleResize);let R=performance.now();return requestAnimationFrame(function gameLoop(e){let t=(e-R)/1e3;if(R=e,n){let e=function(e,t,n){let i=e.position.clone();return t.KeyW&&(i.z-=5*n),t.KeyS&&(i.z+=5*n),t.KeyA&&(i.x-=5*n),t.KeyD&&(i.x+=5*n),e.position.copy(i),e.mesh.position.copy(i),e}(n,k,t);r(e),sendPlayerState({position:e.position,rotation:e.rotation})}for(let e of P)n&&(e.update(t,n),e.mesh.position.lerp(n.position,.01));if(j.objects=M,j.update(t),n)for(let e of P){let t=n.position.distanceTo(e.mesh.position);t<3&&(u(e=>Math.max(e-1,0)),h-1<=0&&m(!0),v(e=>[...e,"Collision Token"]))}if(W&&n){var i,o;i=n.inventory,W.clearRect(0,0,W.canvas.width,W.canvas.height),W.fillStyle="#fff",W.font="24px Arial",W.fillText("Score: ".concat(c),20,40),W.fillText("Lives: ".concat(h),20,70),W.fillText("Level: ".concat(w),20,100),i&&i.length>0&&(W.font="18px Arial",W.fillStyle="#ffcc00",W.fillText("Inventory:",W.canvas.width-220,W.canvas.height-120),i.forEach((e,t)=>{W.fillStyle="#fff",W.fillText(e,W.canvas.width-220,W.canvas.height-100+20*t)})),function(e,t){e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(e.canvas.width-150-20,20,150,150),e.fillStyle="#fff",e.font="12px Arial",e.fillText("MiniMap",e.canvas.width-150-20+10,40),e.fillStyle="#00ffff";let n=e.canvas.width-150-20+t.position.x/window.innerWidth*150,i=20+t.position.z/window.innerHeight*150;e.fillRect(n,i,5,5)}(W,n),o=P.length+M.length+y.length,W.fillStyle="rgba(0,0,0,0.6)",W.fillRect(10,10,170,60),W.fillStyle="#0f0",W.font="14px Courier New",W.fillText("FPS: ".concat(60..toFixed(1)),20,30),W.fillText("Objects: ".concat(o),20,50)}l.render(d,f),requestAnimationFrame(gameLoop)}),()=>{window.removeEventListener("resize",handleResize),i.removeEventListener("click",()=>{}),i.removeEventListener("contextmenu",()=>{})}},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsx)("title",{children:"Ultimate Cosmic Sandbox V3: Evolution Edition"}),(0,i.jsx)("meta",{name:"description",content:"究極のオープンソースMinecraftクローン。最新技術のレンダリング、プロシージャルワールド生成、ネットワーク連携、敵AI、物理シミュレーション、HUD、インベントリシステム、ブロック配置機能を統合した究極のゲーム体験。"})]}),(0,i.jsx)("canvas",{ref:e,style:{position:"absolute",top:0,left:0}}),(0,i.jsx)("canvas",{ref:t,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}})]})}}},function(e){e.O(0,[737,934,774,888,179],function(){return e(e.s=5953)}),_N_E=e.O()}]);